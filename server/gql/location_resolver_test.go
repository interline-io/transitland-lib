package gql

import (
	"testing"
)

func TestLocationResolver(t *testing.T) {
	testcases := []testcase{
		{
			name: "locations for ctran",
			query: `query {
				feed_versions(where: {sha1: "e8bc76c3c8602cad745f41a49ed5c5627ad6904c"}) {
					sha1
					locations(limit: 1) {
						id
					}
				}
			}`,
			expect: `{"feed_versions":[{"locations":[{"id":1}],"sha1":"e8bc76c3c8602cad745f41a49ed5c5627ad6904c"}]}`,
		},
		{
			name: "location fields",
			query: `query {
				feed_versions(where: {sha1: "e8bc76c3c8602cad745f41a49ed5c5627ad6904c"}) {
					locations(limit: 1) {
						location_id
						stop_name
						stop_desc
						zone_id
						stop_url
						geometry
						feed_version {
							sha1
						}
					}
				}
			}`,
			expect: `{"feed_versions":[{"locations":[{"feed_version":{"sha1":"e8bc76c3c8602cad745f41a49ed5c5627ad6904c"},"geometry":{"coordinates":[[[-122.67151988787528,45.640239867113465],[-122.66531553935086,45.640196283362634],[-122.66490760228291,45.64013588505739],[-122.66454068611063,45.63997388749707],[-122.66362140070383,45.63920641403817],[-122.66308366082943,45.63894039603798],[-122.6622399397029,45.63872594572448],[-122.66111535962024,45.63880529545077],[-122.65947652977027,45.63933633170179],[-122.65945763749346,45.639370516569116],[-122.65761727409583,45.63978678396147],[-122.65428757108356,45.639080059577985],[-122.65207272399068,45.63869551462473],[-122.6478525477521,45.63848754690533],[-122.64783134700939,45.63851365039364],[-122.64181726752285,45.63803956014843],[-122.6418217505775,45.63586363794634],[-122.64013391715848,45.63583978393064],[-122.64014198381815,45.637893111129735],[-122.62982020087483,45.63733345560127],[-122.62881757914062,45.63748398884993],[-122.62685692195674,45.63817113526683],[-122.62842022396616,45.639372602559504],[-122.63527305728671,45.64300300957819],[-122.63408470248598,45.643005213585],[-122.63374920628864,45.64336927789179],[-122.63350596062409,45.643983173935034],[-122.63420358334933,45.64438849388529],[-122.63489269067372,45.644610924158805],[-122.63645793595622,45.64459415539177],[-122.63771704271298,45.64589658577323],[-122.63959433879144,45.645787752874305],[-122.63983366686479,45.64606241364155],[-122.64200696797151,45.64645619286868],[-122.64288979024167,45.64683159683269],[-122.64714144922497,45.64958971909228],[-122.64831508883982,45.650078048561625],[-122.65022520970011,45.650439272310905],[-122.65197348186929,45.65047369175858],[-122.6575081621618,45.649741330126],[-122.66760435040396,45.649901662815225],[-122.6684979109249,45.64657292165278],[-122.66861076463377,45.64615776413661],[-122.66876230752703,45.64571362197488],[-122.66885041202838,45.64543700468926],[-122.67151988787528,45.640239867113465]],[[-122.64166509361434,45.63748360138959],[-122.64069536600529,45.63748694143604],[-122.64068103505541,45.63721639702986],[-122.640303653375,45.637199696715115],[-122.64028454544183,45.63595717933418],[-122.64164120869788,45.6359905806994],[-122.64166509361434,45.63748360138959]]],"type":"Polygon"},"location_id":"location_id__c7400cc8-959c-42c8-991f-8f601ec9ea59","stop_desc":null,"stop_name":"Rose Village","stop_url":null,"zone_id":null}]}]}`,
		},
		{
			name: "location filter by id",
			query: `query {
				feed_versions(where: {sha1: "e8bc76c3c8602cad745f41a49ed5c5627ad6904c"}) {
					locations(where: {location_id: ["location_id__11f830d0-adec-468a-a8d6-513184e476a1"]}) {
						location_id
					}
				}
			}`,
			expect: `{"feed_versions":[{"locations":[{"location_id":"location_id__11f830d0-adec-468a-a8d6-513184e476a1"}]}]}`,
		},
		{
			name: "location stop times",
			query: `query {
				feed_versions(where: {sha1: "e8bc76c3c8602cad745f41a49ed5c5627ad6904c"}) {
					locations(limit: 1) {
						stop_times(limit: 1) {
							arrival_time
						}
					}
				}
			}`,
			expect: `{"feed_versions":[{"locations":[{"stop_times":[{"arrival_time":null}]}]}]}`,
		},
	}
	c, _ := newTestClient(t)
	for _, tc := range testcases {
		t.Run(tc.name, func(t *testing.T) {
			queryTestcase(t, c, tc)
		})
	}
}
